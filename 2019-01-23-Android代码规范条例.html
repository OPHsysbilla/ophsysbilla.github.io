<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  
<meta name="google-site-verification" content="bK1M-ocDa0E2dznovP-kDBBKlsyySWWuxAs868D6Xfs">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#fff">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#fff">





  <meta name="keywords" content="Android,">










<meta name="description" content="依然很简洁的条例，备忘用 本篇是搜集关于Android的仅以提醒作用的条例，见名知意。 相关注意事项推荐阅读《阿里巴巴的安卓手册》  条例 onActivityResult()发生在onResume()之前 onFinishInflate()在加载完成xml后执行：只有当自定义View，通过在XML中创建时才会调用。不从xml布局文件中解析的话，比如通过new方式创建，则不会执行该方法；">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 警醒向条例">
<meta property="og:url" content="http://ophsysbilla.github.io/2019-01-23-Android代码规范条例.html">
<meta property="og:site_name" content="Android tips">
<meta property="og:description" content="依然很简洁的条例，备忘用 本篇是搜集关于Android的仅以提醒作用的条例，见名知意。 相关注意事项推荐阅读《阿里巴巴的安卓手册》  条例 onActivityResult()发生在onResume()之前 onFinishInflate()在加载完成xml后执行：只有当自定义View，通过在XML中创建时才会调用。不从xml布局文件中解析的话，比如通过new方式创建，则不会执行该方法；">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-11-09T12:31:35.541Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 警醒向条例">
<meta name="twitter:description" content="依然很简洁的条例，备忘用 本篇是搜集关于Android的仅以提醒作用的条例，见名知意。 相关注意事项推荐阅读《阿里巴巴的安卓手册》  条例 onActivityResult()发生在onResume()之前 onFinishInflate()在加载完成xml后执行：只有当自定义View，通过在XML中创建时才会调用。不从xml布局文件中解析的话，比如通过new方式创建，则不会执行该方法；">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ophsysbilla.github.io/2019-01-23-Android代码规范条例.html">





  <title>Android 警醒向条例 | Android tips</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Android tips</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Satur的博客 | Android wonderland</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ophsysbilla.github.io/2019-01-23-Android代码规范条例.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Satur">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Android tips">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android 警醒向条例</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T00:00:00+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>依然很简洁的条例，备忘用</p>
<p><em>本篇是搜集关于Android的仅以提醒作用的条例，见名知意。 相关注意事项推荐阅读《阿里巴巴的安卓手册》</em> </p>
<h2 id="条例"><a href="#条例" class="headerlink" title="条例"></a>条例</h2><ol>
<li>onActivityResult()发生在onResume()之前</li>
<li>onFinishInflate()在加载完成xml后执行：只有当自定义View，通过在XML中创建时才会调用。不从xml布局文件中解析的话，比如通过new方式创建，则不会执行该方法；<a id="more"></a></li>
<li>foreach使用前需要判空</li>
<li>overridependingtransition()进入动画需要再startActivity之后，退出动画需要再finish后</li>
<li>view的调用过程:构造方法-&gt;onFinishInflate-&gt;onSizeChanged-&gt;onDraw</li>
<li>如果用户finish()方法结束了Activity，则不会调用onSaveInstanceState()</li>
<li>getIntrinsicWidth()和getIntrinsicHeight()</li>
<li>canvas的好处之一是旋转画布后旋转回来，以达到图像绘制部分的旋转，不用对坐标点进行转置</li>
<li>用transient关键字标记的成员变量不参与序列化过程</li>
<li>滑动冲突处理：可以根据滑动距离和水平方向形成的夹角；或者根绝水平和竖直方向滑动的距离差；或者两个方向上的速度差等</li>
<li>getParent().requestDisallowInterceptTouchEvent(false)请求父亲不要阻挡儿子</li>
<li>getSuggestedMinimumWidth的逻辑：View如果没有背景，那么返回android:minWidth这个属性指定的值，这个值可以为0；如果设置了背景，则返回背景的最小宽度和minWidth中的较大值。</li>
<li>Fragment的动画setCustomAnimations()对于反射取FragmentManager中置儿子为null的是有问题的，建议用Fragment自己的onCreateAnimation()函数</li>
<li><strong>OOM</strong>：尽量避免使用帧动画，使用的话应尽量避免使用过多尺寸较大的图片</li>
<li>内存泄露：属性动画中的无限循环动画需要在Activity退出的时候及时停止，否则将导致Activity无法释放而造成内存泄露。view动画不存在这个问题；</li>
<li>当调用到onNewIntent(intent)的时候，需要在onNewIntent() 中使用setIntent(intent)赋值给Activity的Intent.否则，后续的getIntent()都是得到老的Intent</li>
<li>launchMode为singleTask的时候，通过Intent启到一个Activity,如果系统已经存在一个实例，系统就会将请求发送到这个实例上，但这个时候，系统就不会再调用通常情况下处理请求数据的onCreate方法，而是调用onNewIntent方法    </li>
<li>DiffUtil.DiffResult可以使RecyclerView不添加相同的条目，即部分更新</li>
<li>RelativeLayout如果cast到FrameLayout是不必要的，view就可以</li>
<li>自定义view，一定是this(context)、this(context,attr)、super(context, attr, defaltStyle)，注意需要手动调init()或者this(context, null)与this(context,attr,0)</li>
<li>小心使用ArrayList的subList [a, b) ，对生成对新列表的改变会改变原列表结构，可以在新列表前加final来阻止后续更改</li>
<li>RequestLayout() , Invalidate() , layout()的区别</li>
<li>如果需要addView的话，那么使用getLayoutParams是没用的，因为这个你自己新建的一个View，没有与父容器有任何关联。所以LayoutParams也需要你自己创建    </li>
<li>contentInsetStart消除ToolBar在自定义布局中的左部白边</li>
<li>JSONObject中的getString()和optString()方法的区别在于optString()不报错</li>
<li>@Transient标志则不入数据库</li>
<li>overridePendingTransition转移</li>
<li>由于Activity的TaskMode不同所以onActivityResult在Activity的生命周期中执行的先后也是不同的，更有onCreate不会执行的情况，所以onActivityResult有时候提前结束收不到result。</li>
<li>调用startActivityForResult后onActivityResult立刻响应，而返回当前页时onActivityResult不响应主要是launchMode的问题：<ul>
<li>第一种：当resultCode==0时，Activity的launchMode必须设置为”singleTask”或者singleInstance，否则就会出错。这是因为从Task的角度看，Android认为不同Task之间的Activity是不能传递数据的，所以不能使用NEW_TASK标识，但还是要调用forResult方法。</li>
<li>第二种：当resultCode！=0时，Activity的launchMode必须为standard（删除launchMode属性默认为standard模式），原因同上。<ul>
<li>只有第一层fragment会收到onActivityResult</li>
<li>重写onBackPressed() 自定义回退事件可以避免按Back键自动设置resultCode为RESULT_CANCELED的问题</li>
<li>requestCode &gt;=0就好，随便用于在onActivityResult()区别哪个子模块回传的数据，每个区分开不同的requestCode</li>
<li>resultCode 如果B子模块可能有几种不同的结果返回，可以用setResut(int resultCode, Intent intent)予以识别区分</li>
</ul>
</li>
</ul>
</li>
<li><p><code>@IntDef</code> 注解自定义了一个 OrientationType 注解，用于防治用户随意设置数值。<br>使用 <code>@IntRange</code> 方法将行列数限制在一个较合理的范围内。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IntDef</span>(&#123;VERTICAL, HORIZONTAL&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> OrientationType &#123;&#125;            <span class="comment">// 滚动类型</span></span><br><span class="line"><span class="meta">@OrientationType</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mOrientation = HORIZONTAL;          <span class="comment">// 默认水平滚动</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>View child = recycler.getViewForPosition(i);</code>   //如果不存在的话 RecyclerView 会自动创建</p>
</li>
<li>RecyclerView要先移除再添加，这样会移除的 View 会被先放到缓冲区中，再添加 View 时就可以直接从缓冲区中把被移除的条目直接取出来使用了，而不用重新创建，以减少开销；如果先添加，由于缓冲区中没有可以使用的 View，会进行先创建，之后再添加到界面上，最后执行移除操作会导致有大量的 View 滞留在缓冲区中，会造成严重的性能浪费</li>
<li>对Vector、ArrayList在迭代的时候如果同时对其进行修改就会抛出 java.util.ConcurrentModificationException 异常</li>
<li>LinkedList在遍历循环中get(i)时间复杂度为O(n)，比ArrayList的O(1)性能差，使用有迭代器(Iterator)以及ForEach循环来对LinkedList进行遍历</li>
<li>对Activity来说，所有需要传递或接收的Activity不允许设置launchmode=”SingleTask”，只能设为标准模式，否则系统将在 startActivityForResult() 后直接调用 onActivityResult()</li>
<li><p>Builder模式下，需要Builder单独列出的原因之一是，在使用单例模式时，每次都是用的同一个instance，而参数每次都需要重新new一个；不单独写一个Builder出来（第二重）是由于每次都重新new了一个XXX实例，当然参数也每次都不一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XXX</span></span>&#123;</span><br><span class="line">    <span class="comment">//普通单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> XXX instance;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> XXX <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> XXX&#123;&#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Builder</span>()</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">()</span></span>&#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> Builder.<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第二种</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XXX</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> XXX.<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于引用计数的垃圾回收器无法处理循环引用导致的内存泄露问题，但是其在主流的JVM中很少，几乎所有的JVM都是采用引用对象遍历的方法，垃圾回收器都会处理循环引用潜在的问题</p>
</li>
<li><strong>ThreadLocal、Volatile、synchronized、Atomic 的区别？</strong><br>如果只有一个<code>i++;</code>的时候，volatile和synchronized能否互换？volatile作为修饰变量的时候，变量自加中途可能发生线程调度，volatile 可以保证在一个线程的工作内存中修改了该变量的值，该变量的值立即能回显到主内存中，从而保证所有的线程看到这个变量的值是一致的。但是有个前提，因为它不具有操作的原子性，也就是它不适合在对该变量的写操作依赖于变量本身自己。就比如<code>i++</code>、<code>i+=1</code>;这种。但是可以改为<code>num=i+1</code>;如果i是一个 volatile 类型，那么num就是安全的，总之就是不能作用于自身。<br><strong>synchronized</strong>是基于代码块的，只要包含在synchronized块中，就是线程安全的。<br><strong>AtomicInteger</strong>，一个轻量级的synchronized。使用的并不是同步代码块，而是Lock-Free算法(一个死循环调用了底层的比较方法直到相同后才退出循环)，最终的结果就是在高并发的时候，或者说竞争激烈的时候效率比synchronized高一些。<br><strong>ThreadLocal</strong>，线程中私有数据。主要用于线程改变内部的数据时不影响其他线程，使用时需要注意static。<br>再补一个，才学到的。利用clone()方法，如果是一个类的多个对象想共用对象内部的一个变量，而又不想这个变量static，可以使用浅复制方式。(查看设计模式原型模式)</li>
<li>HashTable、SynchronizedCollection、ConcurrentHashMap、Vector</li>
<li><a href="https://blog.csdn.net/mnb65482/article/details/80458571" target="_blank" rel="noopener">静态内部类单例原理</a>，静态内部类单例在反序列化时会重新生成新对象因此需要抛出一个异常，反序列化是比正常创建新对象慢的</li>
<li>compare and set (CAS)，不断重新取值比较，可能会出现ABA问题（中途值被修改又还原）</li>
<li><a href="https://upload-images.jianshu.io/upload_images/2158254-ede2828fcff9398e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" target="_blank" rel="noopener">Message全程持有发送该消息Handler的引用 直到Handler处理完消息，Message回收释放</a><br>实际上经常会出现的Diaglog泄漏就是，Dialog销毁的时候Activity已经销毁，所以会发不出那个Handler</li>
<li>git commit –amend 可以修改提交</li>
<li>onScroll和onFling的区别在于，onFline是用于滑动的最后一下</li>
<li>不要重复 setListener，要使用 v.getId 来复用 Listener，不然会创建一堆 Listener 导致频繁 GC</li>
<li>final与static final的区别是：final在一个对象类唯一，static final在多个对象中都唯一；<br>一个既是static又是final的域只占据一段不能改变的存储空间，只有一份。</li>
<li><p>View的UI刷新，不会导致阻塞的原因是View 的绘制与 Java 代码的looper无关，而是由底层 SurfaceFlinger 自身的事件处理机制处理的</p>
<blockquote>
<p>因为不光是gui，同样的道理在几乎所有编程领域里都是这样的，这背后是线程同步的开销问题。显然两个线程不能同时draw，否则屏幕会花；不能同时insert map，否则内存会花；不能同时write buffer，否则文件会花。需要互斥，比如锁。结果就是同一时刻只有一个线程可以做ui。那么当两个线程互斥几率较大时，或者保证互斥的代码复杂时，选择其中一个长期持有其他发消息就是典型的解决方案。所以普遍的要求<strong>ui只能单线程</strong></p>
</blockquote>
</li>
<li><p>onChildDraw影响触摸事件的接受顺序，同样影响绘制顺序</p>
</li>
<li>对组件 Activity 而言，viewRootImpl 的初始化在 onCreate 之后，onResume 之后，故在onCreate里开子线程更新UI不会报错</li>
<li><a href="https://www.cnblogs.com/linguanh/p/8514643.html" target="_blank" rel="noopener">Glide中into()同一View，但显示不同的图片时（url不同）是使用的同一个Bitmap引用地址，只是像素不一样，在onResourceReady()里可以打印得到的bitmap的地址是一样的</a>。这是因为BitmapPool会复用Request，可能会拿到擦除过的bitmap</li>
<li>bitmap对象是通过env-&gt;NewOject(…)，所以是分配在虚拟机中的</li>
<li>RecyclerView.OnScrollListener()来监听RecyclerView的滚动距离，正常情况下是没有问题的，但是一旦RecyclerView的数据源变了的时候，比如筛选条件变了，需要清除之前的数据，然后重新添加新的数据到RecyclerView里面去，这时候记录的滚动距离就不准了；自定义RecyclerView的LinearLayoutManager来计算滚动距离，但是在滑动的时候特别消耗性能，滑动卡顿</li>
<li>AppCompatActivity获得Activity的方法<a href="https://stackoverflow.com/questions/8276634/android-get-hosting-activity-from-a-view/32973351#32973351" target="_blank" rel="noopener">Android get hosting Activity from a view</a></li>
<li><a href="https://stackoverflow.com/questions/12911504/rationale-for-matcher-throwing-illegalstateexception-when-no-matching-method-i" target="_blank" rel="noopener">Java的正则式首先需要Pattern.compile()后必须要调用find()或者matches()才能找到</a></li>
<li>在自定义控件的构造函数或者其他绘制相关地方使用系统依赖的代码，会导致可视化编辑器无法报错并提示，使用isInEditMode()可以解决在</li>
<li>在Android Studio下的文件<code>app.iml</code>已经制定了assets文件夹的属性，所以直接新建Directory即可</li>
<li><strong>view.layout(l,t,r,b)在子线程中没反应，需要post()或者onAnimationStart中</strong></li>
<li>getGlobalVisibleRect(globalRect)在没有被遮挡（超出屏幕）时和getLocationInWindow数值相同; getDrawingRect(drawingRect)和getLocalVisibleRect(localRect)没有遮挡时测试数值相同都是相对自己的坐标</li>
<li>include设置了id，会覆盖掉layout_activity_head布局文件中根layout的id</li>
<li>全面屏刘海屏的状态栏是很高的，在使用getLocationInWindow时需要特别注意，需要减去的状态栏高度会更高</li>
<li>onCreate期间调用setHasOptionsMenu，则该fragment在其后的onCreateOptionsMenu回调可以接受到设置标题栏的menu</li>
<li>在selector的xml写法中，vector图标不能用<code>android:color/transparent</code>来表明空图像，因为颜色是没有高度的（instrictWidth），并且导致后续高宽不会自动更新<blockquote>
<p>直接在selector的xml中设置item为透明 <code>&lt;item android:drawable=&quot;@android:color/transparent&quot; android:state_checked=&quot;false&quot; /&gt;</code> 的写法是错误的，会导致高宽都变化为0，并且高宽不会自动更新。应该更改vector的文件的颜色为android:fillColor=”#00000000”</p>
</blockquote>
</li>
<li>设置Acticity为全屏会获得和adjustNothing一样的效果，不会顶起布局</li>
<li>viewstub被inflate后会消失，包括它的id，可以使用android:inflatedId=”@id/vs_bottom”来规定它被inflate后叫什么，这样可以防止viewStub消失后其他引用它的布局失去了依赖</li>
<li>rxjava中的timer也可以加入自己的scheduler</li>
<li>viewstub的布局参数应当写到viewstub内，比如margin值，写在layout内是无效的 ,但是padding是可以写在layout内的；ViewStub中不能用merge</li>
<li>android中setOnClickListener会自动设置view为clickable = true，所以自定义的simpleAdapter添加setOnItemClick的时候需要自动添加view的clickable = true</li>
<li>may not a tips:  GreenDao主键自增类型必须是Long，而不是long。否则你会发现id永远为0，永远只有一个数据</li>
<li>onStop可能不会被调用（eg. 新Acitivity采用了透明主题，当前Actiivty不会回调onStop）</li>
<li>回到原Activity  onRestart -&gt; onStart -&gt; onResume</li>
<li>每个View都可以onSaveInstanceState，并且onSaveInstanceState及onRestoreInstanceState是和onStop及onStart绑定的，onSaveInstanceState在onStop前，onRestoreInstanceState在onStart后</li>
<li>onNewIntent()—-&gt;onResart()——&gt;onStart()—–&gt;onResume(). 且当调用到onNewIntent(intent)的时候，需要在onNewIntent() 中使用setIntent(intent)赋值给Activity的Intent.否则，后续的getIntent()都是得到老的Intent。</li>
<li>singleTask的Actiivty被启用时，在其上的栈顶都会被清空（默认具有FLAG_ACTIVITY_CLEAR_TOP）<br>85.<code>fitsSystemWindows=true</code>要慎用，很多坑。比如WebView中输入框获取焦点弹出软键盘时出现抖动，还有哪个View设置了fitsSystemWindows=true软键盘弹出时哪个View就会被顶上去；</li>
<li><code>WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS</code>不要用，会导致EMUI3.1的系统下面虚拟按键挡住布局</li>
<li><p>事件传递</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">bool <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span></span>&#123;</span><br><span class="line">    bool consume = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(onInterceptTouchEvent(ev))&#123;</span><br><span class="line">        consume = onTouchEvent(ev);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        consume = child.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FragmentStatePagerAdapter和FragmentPagerAdapter都没有从viewGroup中removeView，而是transaction中detach/ remove掉了， 因此viewPager在保存不是fragment的时候需要警惕，其他view并不会像fragment一样刷新</p>
</li>
<li>PathMeasure的forceClosed参数对绑定的Path不会产生任何影响，例如一个折线段的Path，本身是没有闭合的，forceClosed设置为True的时候，PathMeasure计算的Path是闭合的，但Path本身绘制出来是不会闭合的。 - <a href="http://www.gcssloop.com" target="_blank" rel="noopener">均摘自 gcssloop </a><br>forceClosed参数对PathMeasure的测量结果有影响，还是例如前面说的一个折线段的Path，本身没有闭合，forceClosed设置为True，PathMeasure的计算就会包含最后一段闭合的路径，与原来的Path不同。</li>
<li><code>Math.atan2(tan[1],tan[0])</code>解释：tan[0] = cos = 邻边(单位圆x坐标)，tan[1] = sin = 对边(单位圆y坐标)，因此可以计算任意两点间的斜率夹角</li>
<li>pre和post，左乘进行行变换，右乘进行列变换，pre表明M左乘pre，poste表明M右乘pre，M表明矩阵</li>
<li>由于硬件加速的问题，PathMeasure中的getSegment在讲Path添加到dst数组中时会被导致一些错误，需要通过<code>mDst.lineTo(0,0)</code>来避免这样一个Bug</li>
<li><code>measure.getMatrix(distance, matrix, 
PathMeasure.TANGENT_MATRIX_FLAG | PathMeasure.POSITION_MATRIX_FLAG);</code><br>这个方法是用于得到路径上某一长度的位置以及该位置的正切值的矩阵</li>
<li><strong>透明主题的坑</strong>：<ul>
<li>坑一：透明主题的 Activity 如果弹出键盘，并且是 adjustResize 模式，在键盘弹出的一瞬间可以看到前一个 Activity<blockquote>
<ol>
<li>原因：键盘弹起时，Activity 重新计算了高度缩短了，而键盘弹起有一个动画，在动画没有执行完毕之前，键盘所占用的空间上没有别的布局只有 Window ，而 Window 是透明的因此就看到了上一个 Activity</li>
<li>尝试的解决方案：在动画执行完毕后，将 Window 的背景设置为不透明，但是失败了，见坑二</li>
</ol>
</blockquote>
</li>
<li>坑二：如果当前的 Window 背景带有透明度，在动态改变背景的时候会闪一下屏，如果 Window 的初始背景颜色没有透明度，动态改变背景很完美<blockquote>
<ol>
<li>原因：不详，目测是 Android 的 bug</li>
<li>解决方案：无。。。</li>
</ol>
</blockquote>
</li>
<li>坑三：也是由解决坑二造成的，我试图通过监听键盘弹起事件来手动调节布局，这样 Activity 不需要 resize 也就没有那个 bug，但是发现监听键盘弹起的方法基本都是监听 Activity 重新布局后对比高度来判断的，因此在 adjustNothing 状态下无效，值得一提的是，跟三弟交流发现他们钻了一个空子，当 Activity 为全屏状态时 adjustResize 是不生效的，但是可以监听到键盘弹出，所以相当于是adjustNothing的效果，但这种情况没法在我这个项目使用。</li>
</ul>
</li>
<li>对window.addFlags需要在<code>setContentView</code>前</li>
<li>sqlLight数据库<code>not null</code>只针对于text为<code>null</code>的情况，但是text为<code>&quot;&quot;</code>时是可以插入的。</li>
<li>数据库的unique属性的列，insert()一旦失败，则批量都失败。此时可以用insert or replace，不会影响批量中其他数据的插入。</li>
<li><code>setRetainInstance(true)</code>设置为true，表示 configuration change 的时候，fragment实例不会背重新创建，即重建时不会经过onDestroy和onCreate。</li>
<li><p>fragment 该方法也常常被用来处理 Activity re-creation 时候数据的保存。因此可以干很多骚操作，但即使是使用setRetainInstance还是有一定概率会被回收的，重新创建fragment后，requestCode和callback的关系就没有了。</p>
<blockquote>
<p>fragment 该方法也常常被用来处理 Activity re-creation 时候数据的保存。因此可以干很多骚操作，但即使是使用setRetainInstance还是有一定概率会被回收的，重新创建fragment后，requestCode和callback的关系就没有了。 </p>
</blockquote>
</li>
<li><p><code>SharedPreferences</code>是文件的一种，读写有一定的缓存策略，在内存中会有一份<code>SharedPreferences</code>文件的缓存，因此在多进程模式下其读写就变得不可靠。当面对高并发读写访问的时候，有很大几率会<strong>丢失数据</strong>，故不建议在进程间通信中使用<code>SharedPreferences</code></p>
</li>
<li>Messenger是一种轻量级的<code>IPC</code>方案，它的底层实现就是<code>AIDL</code>。Messenger是以串行的方式处理请求的，即服务端只能一个个处理，不存在并发执行的情形</li>
<li>rxjava2不接受<code>null</code>，会报错</li>
<li><code>DialogFragment</code>的出现解决AlertDialog和PopupWindow随屏幕切换而消失的问题</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Window window = getDialog().getWindow();</span><br><span class="line">        window.setLayout(ViewGroup.LayoutParams.MATCH_PARENT, </span><br><span class="line">        ViewGroup.LayoutParams.MATCH_PARENT);</span><br></pre></td></tr></table></figure>
<p>等效于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DisplayMetrics dm = <span class="keyword">new</span> DisplayMetrics();</span><br><span class="line">getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != window) &#123;</span><br><span class="line">    window.setLayout(dm.widthPixels, dm.heightPixels);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fragment的commit和commitAllowingStateLoss的区别</p>
<ul>
<li>onSaveInstanceState()再onStop()前调用，而再Honeycomb前，是在onPause()前立即调用的，因为Honeycomb前对于回收来说一不可见Activity就被kill了，Honeycomb后Activity要在onStop后才能被kill掉</li>
<li><em>参见<a href="https://www.androiddesignpatterns.com/2013/08/fragment-transaction-commit-state-loss.html" target="_blank" rel="noopener">Fragment Transactions &amp; Activity State Loss</a></em></li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/attheway/article/details/44220729" target="_blank" rel="noopener">Android 代码proguard混淆之后的错误log查看方法</a></p>
<blockquote>
<p>项目目录的progurad下有一个mapping.txt文件 这是混淆后的名字和原名字的映射关系。在ADT安装目录的sdk\tools\proguard\bin下有三个工具，其中proguardgui.bat就是用来还原的图形化工具。</p>
</blockquote>
</li>
<li><p>6.0后需要动态申请权限，7.0后需要通过FileProvider访问其他的权限。6.0后的动态申请权限，有可能会出现未授权时录音，<a href="https://mp.weixin.qq.com/s/Xe-RbtackyzgLbh8DBqYfQ" target="_blank" rel="noopener">Android录音数据前几千个字节为空的问题</a>。</p>
</li>
<li>多进程在进程被kill掉的时候来不及正常调用onDestroy等流程，此时会通过binder通知其他进程自己死掉了，见<a href="https://www.androiddesignpatterns.com/2013/08/binders-death-recipients.html" target="_blank" rel="noopener">Binder死亡通知机制之linkToDeath</a></li>
<li>Fragment的可见性：onHiddenChanged()只会在对fragment进行show/hide变换时调用，第一次进入的时候不会调用，在使用beginTransaction().hide(Fragment)会被调用，而且是在onResume之前；而在viewpager中的fragment则完全不一样，需要手动调用setUserVisible(boolean)。 <blockquote>
<ul>
<li><a href="http://jcodecraeer.com/a/anzhuokaifa/androidkaifa/2017/0422/7863.html" target="_blank" rel="noopener">注意onHiddenChanged的特殊情况</a></li>
<li><a href="https://www.smwenku.com/a/5ba1abcd2b71771a4da995ba/zh-cn/" target="_blank" rel="noopener">Android Fragment可见性的判断与监听完全实现</a> </li>
</ul>
</blockquote>
</li>
<li>ViewGroup默认情况不会调用onDraw()，它在init中会被设置成WILL_NOT_DRAW，这是从性能考虑，这样一来，onDraw就不会被调用了。如果我们要重要一个ViweGroup的onDraw方法，有两种方法：<blockquote>
<ul>
<li>在构造函数里面，给其设置一个颜色，如#00000000。</li>
<li>在构造函数里面，调用setWillNotDraw(false)，去掉其WILL_NOT_DRAW flag<br>110.可以使用<code>.adjustViewBounds(true)</code>方法来设置宽度铺满屏幕的ImageView，但是对于<a href="https://inthecheesefactory.com/blog/correct-imageview-adjustviewbounds-with-adjustable-imageview/en" target="_blank" rel="noopener">小于17的版本不能正确显示</a></li>
</ul>
</blockquote>
</li>
<li>fragment重叠的问题：只需要在onSaveInstanceState中置空fragmnet状态即可-》outState.putParcelable(“android:support:fragments”, null);</li>
<li><code>drawable.getConstantState().newDrawable()</code>使用的是相同<code>ConstantState</code>下新建了一个drawable，和<code>getResources().getDrawable(R.drawable.xxx)</code>返回的对象一样。所有从本地资源读取图片资源<code>getResources().getDrawable(R.drawable.xxx)</code>的drawable都共享<code>ConstantState</code>，<strong>对一个drawable做更改会影响其他drawable持有相同<code>ConstantState</code>的drawable</strong>，eg. 修改alpha。可以使用<code>drawable.mutate()</code>来创建一个不共享的drawable。<blockquote>
<p><a href="xhttps://www.heqiangfly.com/2017/06/15/android-knowledge-point-drawable-cache/" target="_blank" rel="noopener">关于Drawable的缓存机制应该了解的知识</a></p>
</blockquote>
</li>
<li>很悲伤的是<code>Rxjava</code>中<code>DisposableSubscriber</code>的<code>onStart()</code>是在subscribeOn指定的线程上进行的（通常是子线程），它在整个任务的开始的时候调用。而<code>onComplete()</code>、<code>onNext()</code>、<code>onError()</code>是在observeOn指定的线程上进行的（通常是UI线程）。事实上，如果不指定线程，observe都将在主线程进行</li>
<li>注意RecycleView里都每个子项设置<code>focusable</code>=true的时候，这个时候设置点击就可能被最后一个抢掉了。</li>
<li>当一个Activity反常销毁重建的时候，请先查看下你的“不保留活动“是不是开启了。</li>
<li>dp和px的关系，是与屏幕像素密度为160的倍数而不同：像素密度为160时1px = 1dp<br>117.</li>
</ol>
<h2 id="更多应该阅读的"><a href="#更多应该阅读的" class="headerlink" title="更多应该阅读的"></a>更多应该阅读的</h2><ol>
<li>CopyOnWriteArrayList</li>
<li>ThreadPoolExecutor</li>
<li>WeakHashMap</li>
<li>Activity的SingleTask模式，使得onIntent可用</li>
<li>notifyItemChanged，因为DataSetChange可能会造成闪烁</li>
<li>Producer Extends Consumer Super</li>
<li>&lt;? extends Fruits&gt;   &lt;? super Apple&gt;</li>
<li>基于Window.ID_ANDROID_CONTENT给定id添加子View</li>
<li>ArrayList ，LinkedList不同步   Vector同步</li>
<li>HashSet，LinkedHashSet,HashMap 不同步 </li>
<li>HashTable 同步</li>
<li>同步的ArrayList = Collections.synchronizedList(new ArrayList(…));</li>
<li>SpannableString</li>
<li>数据库索引失败</li>
<li>Encapsulate Collection</li>
<li>学习JEE规范，去看JBoss源码；学习类加载器，就去看OSGI源码</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019-01-22-如何快速搭建个人博客.html" rel="next" title="如何快速搭建个人博客">
                <i class="fa fa-chevron-left"></i> 如何快速搭建个人博客
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019-01-23-算法简明笔记.html" rel="prev" title="算法简明笔记">
                算法简明笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Satur</p>
              <p class="site-description motion-element" itemprop="description">Satur的博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#条例"><span class="nav-text">条例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更多应该阅读的"><span class="nav-text">更多应该阅读的</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Satur</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
